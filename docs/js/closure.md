# 闭包

## 定义

如果一个函数访问了此函数的父级及父级以上的作用域变量（自由变量），那么这个函数就是一个闭包。  
闭包会创建一个包含外部函数作用域变量的环境，并将其保存在内存中，这意味着当外部函数执行完毕出栈后，闭包仍然可以访问外部函数的变量。  

```js
function addTimes() {
  	let times = 0;
	function add() {
		times++;
		console.log('次数：',times);
	}
	return add;
}
// addTimes 函数执行完毕，外部作用域链仍然存在，即times变量仍然在内存中
const add = addTimes();
add();  // 次数： 1
add();  // 次数： 2
```

## 优缺点

优点：
1. 缓存变量，可用于实现计数器等
2. 私有化变量，可用于实现模块化等

缺点：
1. 内存泄漏，变量常驻内存无法被GC（垃圾回收）回收

## 垃圾回收

1. 引用计数法：chrome的V8引擎没有使用该方法，这种方式无法解决A和B循环引用问题
2. 可访问性分析法：V8使用了该方法。从一个GC Roots对象出发（window对象，dom节点集合等）, 能遍历到的认为是可访问的，为活动对象。不能遍历到的则认为不可访问，垃圾回收。